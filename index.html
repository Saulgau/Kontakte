<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Kontakte</title>
  <style>
    /* Basis-Styling à la Apple */
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
      margin: 0;
      padding: 0;
      background-color: #f2f2f2;
      color: #333;
    }
    header {
      background-color: #fff;
      padding: 10px 20px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    header h1 {
      font-size: 24px;
      margin: 0;
    }
    header button {
      background: none;
      border: none;
      font-size: 24px;
      cursor: pointer;
      margin-left: 10px;
    }
    .search-bar {
      padding: 10px 20px;
      background-color: #fff;
      border-bottom: 1px solid #ddd;
    }
    .search-bar input {
      width: 100%;
      padding: 8px;
      font-size: 16px;
      border: 1px solid #ccc;
      border-radius: 4px;
    }
    .container {
      display: flex;
      height: calc(100vh - 120px);
    }
    .sidebar {
      width: 300px;
      background-color: #fff;
      border-right: 1px solid #ddd;
      overflow-y: auto;
    }
    .content {
      flex-grow: 1;
      padding: 20px;
      overflow-y: auto;
      background-color: #fff;
    }
    .contact-list {
      list-style: none;
      margin: 0;
      padding: 0;
    }
    .contact-list li {
      padding: 15px 20px;
      border-bottom: 1px solid #eee;
      cursor: pointer;
    }
    .contact-list li:hover {
      background-color: #f9f9f9;
    }
    .contact-list li.active {
      background-color: #e6f7ff;
    }
    /* Detailansicht */
    .detail-view img {
      width: 100px;
      height: 100px;
      border-radius: 50%;
      object-fit: cover;
      margin-bottom: 15px;
    }
    .detail-view h2 {
      margin-top: 0;
    }
    .detail-field {
      margin-bottom: 10px;
    }
    .detail-field strong {
      display: inline-block;
      width: 100px;
    }
    .action-buttons {
      margin-top: 20px;
    }
    .action-buttons button {
      padding: 10px 15px;
      margin-right: 10px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 16px;
    }
    .btn-edit { background-color: #007aff; color: #fff; }
    .btn-delete { background-color: #ff3b30; color: #fff; }
    .btn-add    { background-color: #34c759; color: #fff; }
    .btn-export, .btn-import { background-color: #8e8e93; color: #fff; }
    .hidden { display: none; }

    /* Modal für Hinzufügen/Bearbeiten */
    .modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0,0,0,0.5);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
    }
    .modal-content {
      background-color: #fff;
      padding: 20px;
      border-radius: 8px;
      max-width: 600px;
      width: 100%;
      max-height: 90vh;
      overflow-y: auto;
    }
    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .modal-header h2 {
      margin: 0;
    }
    .modal-header button {
      background: none;
      border: none;
      font-size: 24px;
      cursor: pointer;
    }
    .modal-body {
      margin-top: 20px;
    }
    .modal-body label {
      display: block;
      margin-bottom: 5px;
      font-weight: bold;
    }
    .modal-body input,
    .modal-body textarea {
      width: 100%;
      padding: 8px;
      margin-bottom: 10px;
      border: 1px solid #ccc;
      border-radius: 4px;
      font-size: 16px;
    }
    .modal-footer {
      text-align: right;
    }
    .modal-footer button {
      padding: 10px 15px;
      margin-left: 10px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 16px;
    }
    .btn-save { background-color: #007aff; color: #fff; }
    .btn-cancel { background-color: #8e8e93; color: #fff; }

    /* Responsive */
    @media (max-width: 768px) {
      .container {
        flex-direction: column;
        height: auto;
      }
      .sidebar {
        width: 100%;
        border-right: none;
        border-bottom: 1px solid #ddd;
      }
    }
  </style>
</head>
<body>
  <header>
    <h1>Kontakte</h1>
    <div>
      <button onclick="openAddModal()" title="Neuer Kontakt">＋</button>
      <button onclick="exportContacts()" class="btn-export" title="Exportieren">⇩</button>
      <button onclick="document.getElementById('importFile').click()" class="btn-import" title="Importieren">⇧</button>
      <input type="file" id="importFile" class="hidden" onchange="importContacts(event)">
    </div>
  </header>
  <div class="search-bar">
    <input type="text" id="searchInput" placeholder="Suche Kontakte" oninput="searchContacts()">
  </div>
  <div class="container">
    <div class="sidebar">
      <ul id="contactList" class="contact-list">
        <!-- Kontaktliste -->
      </ul>
    </div>
    <div class="content">
      <div id="detailView" class="detail-view">
        <p>Wähle einen Kontakt aus der Liste, um die Details anzuzeigen.</p>
      </div>
    </div>
  </div>

  <!-- Modal für Hinzufügen/Bearbeiten -->
  <div id="contactModal" class="modal hidden">
    <div class="modal-content">
      <div class="modal-header">
        <h2 id="modalTitle">Neuer Kontakt</h2>
        <button onclick="closeModal()">✕</button>
      </div>
      <div class="modal-body">
        <form id="contactForm">
          <input type="hidden" id="contactId">
          <label for="firstName">Vorname</label>
          <input type="text" id="firstName" required>
          <label for="lastName">Nachname</label>
          <input type="text" id="lastName" required>
          <label for="company">Firma</label>
          <input type="text" id="company">
          <label for="title">Position</label>
          <input type="text" id="title">
          <label for="phone">Telefon</label>
          <input type="tel" id="phone">
          <label for="mobile">Mobil</label>
          <input type="tel" id="mobile">
          <label for="email">E-Mail</label>
          <input type="email" id="email">
          <label for="street">Straße</label>
          <input type="text" id="street">
          <label for="postalCode">PLZ</label>
          <input type="text" id="postalCode">
          <label for="city">Stadt</label>
          <input type="text" id="city">
          <label for="country">Land</label>
          <input type="text" id="country">
          <label for="birthday">Geburtstag</label>
          <input type="date" id="birthday">
          <label for="url">Website</label>
          <input type="url" id="url">
          <label for="note">Notizen</label>
          <textarea id="note" rows="3"></textarea>
          <label for="image">Foto (Bild-URL)</label>
          <input type="url" id="image" placeholder="https://">
        </form>
      </div>
      <div class="modal-footer">
        <button class="btn-cancel" onclick="closeModal()">Abbrechen</button>
        <button class="btn-save" onclick="saveContact()">Speichern</button>
      </div>
    </div>
  </div>

  <script>
    let contacts = [];
    let selectedContactId = null;

    // Eindeutige ID generieren
    function generateId() {
      return '_' + Math.random().toString(36).substr(2, 9);
    }

    // Kontakte aus localStorage laden
    function loadContacts() {
      const saved = localStorage.getItem('contacts');
      if (saved) {
        contacts = JSON.parse(saved);
      }
      displayContactList();
    }

    function saveContacts() {
      localStorage.setItem('contacts', JSON.stringify(contacts));
    }

    // Exportfunktion (unverändert)
    function exportContacts() {
      const dataStr = JSON.stringify(contacts);
      const dataUri = 'data:application/json;charset=utf-8,' + encodeURIComponent(dataStr);
      const linkElement = document.createElement('a');
      linkElement.setAttribute('href', dataUri);
      linkElement.setAttribute('download', 'contacts.json');
      linkElement.click();
    }

    // Importfunktion (unverändert)
    function importContacts(event) {
      const file = event.target.files[0];
      if (!file) return;
      const reader = new FileReader();
      reader.onload = function(e) {
        const contents = e.target.result;
        const importedContacts = JSON.parse(contents);
        // Neue Kontakte hinzufügen (Duplikate anhand Vor- und Nachname + Telefon vermeiden)
        importedContacts.forEach(ic => {
          if (!contacts.some(c =>
              c.firstName === ic.firstName &&
              c.lastName === ic.lastName &&
              c.phone === ic.phone
            )) {
            contacts.push(ic);
          }
        });
        saveContacts();
        displayContactList();
        alert('Kontakte wurden erfolgreich importiert.');
      };
      reader.readAsText(file);
    }

    // Anzeige der Kontaktliste
    function displayContactList() {
      const list = document.getElementById('contactList');
      list.innerHTML = '';
      // Sortierung nach Nachname, dann Vorname
      contacts.sort((a, b) => {
        if (a.lastName === b.lastName) {
          return a.firstName.localeCompare(b.firstName);
        }
        return a.lastName.localeCompare(b.lastName);
      });
      contacts.forEach(contact => {
        const li = document.createElement('li');
        li.textContent = contact.firstName + ' ' + contact.lastName;
        li.onclick = () => showContactDetail(contact.id);
        if (contact.id === selectedContactId) {
          li.classList.add('active');
        }
        list.appendChild(li);
      });
    }

    // Suchfunktion
    function searchContacts() {
      const term = document.getElementById('searchInput').value.toLowerCase();
      const listItems = document.querySelectorAll('#contactList li');
      listItems.forEach(li => {
        li.style.display = li.textContent.toLowerCase().includes(term) ? '' : 'none';
      });
    }

    // Detailansicht eines Kontakts anzeigen
    function showContactDetail(id) {
      selectedContactId = id;
      displayContactList();
      const contact = contacts.find(c => c.id === id);
      const detail = document.getElementById('detailView');
      if (!contact) {
        detail.innerHTML = '<p>Kontakt nicht gefunden.</p>';
        return;
      }
      detail.innerHTML = `
        <div>
          ${contact.image ? `<img src="${contact.image}" alt="Foto">` : ''}
          <h2>${contact.firstName} ${contact.lastName}</h2>
          ${contact.company ? `<p class="detail-field"><strong>Firma:</strong> ${contact.company}</p>` : ''}
          ${contact.title ? `<p class="detail-field"><strong>Position:</strong> ${contact.title}</p>` : ''}
          ${contact.phone ? `<p class="detail-field"><strong>Telefon:</strong> ${contact.phone}</p>` : ''}
          ${contact.mobile ? `<p class="detail-field"><strong>Mobil:</strong> ${contact.mobile}</p>` : ''}
          ${contact.email ? `<p class="detail-field"><strong>E-Mail:</strong> ${contact.email}</p>` : ''}
          ${(contact.street || contact.city || contact.postalCode || contact.country) ? 
            `<p class="detail-field"><strong>Adresse:</strong> ${contact.street || ''} ${contact.postalCode || ''} ${contact.city || ''} ${contact.country || ''}</p>` 
            : ''}
          ${contact.birthday ? `<p class="detail-field"><strong>Geburtstag:</strong> ${contact.birthday}</p>` : ''}
          ${contact.url ? `<p class="detail-field"><strong>Website:</strong> <a href="${contact.url}" target="_blank">${contact.url}</a></p>` : ''}
          ${contact.note ? `<p class="detail-field"><strong>Notizen:</strong> ${contact.note}</p>` : ''}
          <div class="action-buttons">
            <button class="btn-edit" onclick="openEditModal('${contact.id}')">Bearbeiten</button>
            <button class="btn-delete" onclick="deleteContact('${contact.id}')">Löschen</button>
          </div>
        </div>
      `;
    }

    // Modal öffnen zum Hinzufügen eines neuen Kontakts
    function openAddModal() {
      selectedContactId = null;
      document.getElementById('modalTitle').textContent = 'Neuer Kontakt';
      document.getElementById('contactForm').reset();
      document.getElementById('contactId').value = '';
      document.getElementById('contactModal').classList.remove('hidden');
    }

    // Modal öffnen zum Bearbeiten
    function openEditModal(id) {
      const contact = contacts.find(c => c.id === id);
      if (!contact) return;
      selectedContactId = id;
      document.getElementById('modalTitle').textContent = 'Kontakt bearbeiten';
      document.getElementById('firstName').value   = contact.firstName;
      document.getElementById('lastName').value    = contact.lastName;
      document.getElementById('company').value     = contact.company || '';
      document.getElementById('title').value       = contact.title || '';
      document.getElementById('phone').value       = contact.phone || '';
      document.getElementById('mobile').value      = contact.mobile || '';
      document.getElementById('email').value       = contact.email || '';
      document.getElementById('street').value      = contact.street || '';
      document.getElementById('postalCode').value  = contact.postalCode || '';
      document.getElementById('city').value        = contact.city || '';
      document.getElementById('country').value     = contact.country || '';
      document.getElementById('birthday').value    = contact.birthday || '';
      document.getElementById('url').value         = contact.url || '';
      document.getElementById('note').value        = contact.note || '';
      document.getElementById('image').value       = contact.image || '';
      document.getElementById('contactId').value   = contact.id;
      document.getElementById('contactModal').classList.remove('hidden');
    }

    // Modal schließen
    function closeModal() {
      document.getElementById('contactModal').classList.add('hidden');
    }

    // Kontakt speichern (neu oder aktualisieren)
    function saveContact() {
      const contactData = {
        id: document.getElementById('contactId').value || generateId(),
        firstName: document.getElementById('firstName').value,
        lastName: document.getElementById('lastName').value,
        company: document.getElementById('company').value,
        title: document.getElementById('title').value,
        phone: document.getElementById('phone').value,
        mobile: document.getElementById('mobile').value,
        email: document.getElementById('email').value,
        street: document.getElementById('street').value,
        postalCode: document.getElementById('postalCode').value,
        city: document.getElementById('city').value,
        country: document.getElementById('country').value,
        birthday: document.getElementById('birthday').value,
        url: document.getElementById('url').value,
        note: document.getElementById('note').value,
        image: document.getElementById('image').value
      };

      const index = contacts.findIndex(c => c.id === contactData.id);
      if (index > -1) {
        contacts[index] = contactData;
      } else {
        contacts.push(contactData);
      }
      saveContacts();
      displayContactList();
      showContactDetail(contactData.id);
      closeModal();
    }

    // Kontakt löschen
    function deleteContact(id) {
      if (!confirm('Möchten Sie diesen Kontakt wirklich löschen?')) return;
      contacts = contacts.filter(c => c.id !== id);
      saveContacts();
      selectedContactId = null;
      document.getElementById('detailView').innerHTML = '<p>Wähle einen Kontakt aus der Liste, um die Details anzuzeigen.</p>';
      displayContactList();
    }

    window.onload = loadContacts;
  </script>
</body>
</html>